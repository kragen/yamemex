<h1>Your Yamemex Annotations</h1>
<div id="entries"></div>
<style>
/* New stylesheet inspired by the one on <http://worrydream.com/KillMath/>
*/
@font-face {
    font-family: "CandalRegular";
    src: url('Candal/Candal.ttf') format('truetype');
}

body { 
    margin: 0 auto;
    padding: 0;
    font: 13px Optima, Helvetica, Arial, sans-serif;
    color: #666;
    width: 50em;
}

h1, h2 { 
    font-family: "CandalRegular";
    text-align: center;
    color: #600;
    padding: 0;
}

h1 {
    font-size: 2em;
    margin-top: 1.57em;
}

h2 { 
    font-size: 1.5em;
    margin-top: 2em;
}

ul, li { margin: 0; padding: 0 }
ul { list-style-type: none }
li { margin-top: 1em; margin-bottom: 1em; line-height: 1.7 }

a { color: #933 }

</style>
<script src="jquery-1.5.2.min.js"></script>
<script src="mustache/mustache.js"></script>
<script src="db.js"></script>
<script>
$(renderBlog);

var template = 
    '{{#sections}}' +
    '<h2>{{date}}</h2>' +
    '  <ul>' +
    '    {{#bookmarks}}' +
    '      <li><a href="{{url}}">{{title}}</a> ' +
    '        <span class="annotation">{{annotation}}</span>' +
    '      </li>' +
    '    {{/bookmarks}}' +
    '  </ul>' +
    '{{/sections}}' ;

function renderBlog() {
    var start = new Date();
    sql( 'select *, date(timestamp) as date from annotations ' +
         'order by timestamp desc'
       , []
       , function(t, results) {
           var sections = [];
           var section = { };

           for (var ii = 0; ii < results.rows.length; ii++) {
               var row = results.rows.item(ii);

               if (row.date !== section.date) {
                   section = { date: row.date, bookmarks: [] };
                   sections.push(section);
               }

               section.bookmarks.push({ url: row.url
                                      , title: row.title || '<link>'
                                      , annotation: row.annotation
                                      });
           }

           $('#entries').html(Mustache.to_html(template, 
                                               {sections: sections}));

           var end = new Date();
           $('<p/>')
               .text( 'Rendering '+results.rows.length
                    + ' items took '
                    + ((end.getTime() - start.getTime())/1000)
                    + ' seconds.'
                    )
               .appendTo($('body'))
           ;
       }
       );
}

</script>
