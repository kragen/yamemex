<h1>all yamemex annotations for web pages</h1>
<div id="entries"></div>
<script src="jquery-1.5.2.min.js"></script>
<script src="mustache/mustache.js"></script>
<script src="db.js"></script>
<script>
$(renderBlog);

var template = 
    '{{#sections}}' +
    '<h2>{{date}}</h2>' +
    '  <ul>' +
    '    {{#bookmarks}}' +
    '      <li><a href="{{url}}">{{title}}</a> ' +
    '        <span class="annotation">{{annotation}}</span>' +
    '      </li>' +
    '    {{/bookmarks}}' +
    '  </ul>' +
    '{{/sections}}' ;

function renderBlog() {
    var start = new Date();
    sql( 'select *, date(timestamp) as date from annotations ' +
         'order by timestamp desc'
       , []
       , function(t, results) {
           var sections = [];
           var section = { };

           for (var ii = 0; ii < results.rows.length; ii++) {
               var row = results.rows.item(ii);

               if (row.date !== section.date) {
                   section = { date: row.date, bookmarks: [] };
                   sections.push(section);
               }

               section.bookmarks.push({ url: row.url
                                      , title: row.title || '<link>'
                                      , annotation: row.annotation
                                      });
           }

           $('#entries').html(Mustache.to_html(template, 
                                               {sections: sections}));

           var end = new Date();
           $('<p/>')
               .text( 'Rendering '+results.rows.length
                    + ' items took '
                    + ((end.getTime() - start.getTime())/1000)
                    + ' seconds.'
                    )
               .appendTo($('body'))
           ;
       }
       );
}

</script>
