<!doctype html>
<html><head>
    <title>all yamemex annotations for web pages</title>
<style>

body { 
    margin: 0;
    padding: 0;
    font-family: "URW Palladio L", Palatino;
    background: url(write-big-gray.png) top left no-repeat;
    background-attachment: fixed;
}

h1 { 
    background-color: #c99;
    letter-spacing: 0.3em;
    text-align: right;
    color: white;
    padding: 0.5em;
}

h1, h2 { 
    margin: 0; 
    text-shadow: rgba(255,255,255,0.7) 2px 2px 6px; /* color x y radius */
}

h2 { background-color: #fcc; color: #666; padding: 0 0.5em; }

li span { color: #c66; font-size: 0.9em }

ul { max-width: 40em; list-style-type: none }

li { margin-top: 0.5em; line-height: 1.2em }

</style>
<script src="jquery-1.5.2.min.js"></script>
<script src="mustache/mustache.js"></script>
<script src="db.js"></script>
<script>
$(renderBlog);

var template = 
    '{{#sections}}' +
    '<h2>{{date}}</h2>' +
    '  <ul>' +
    '    {{#bookmarks}}' +
    '      <li><a href="{{url}}">{{title}}</a> ' +
    '        <span class="annotation">{{annotation}}</span>' +
    '      </li>' +
    '    {{/bookmarks}}' +
    '  </ul>' +
    '{{/sections}}' ;

function renderBlog() {
    var start = new Date();
    sql( 'select *, date(timestamp) as date from annotations ' +
         'order by timestamp desc'
       , []
       , function(t, results) {
           var sections = [];
           var section = { };

           for (var ii = 0; ii < results.rows.length; ii++) {
               var row = results.rows.item(ii);

               if (row.date !== section.date) {
                   section = { date: row.date, bookmarks: [] };
                   sections.push(section);
               }

               section.bookmarks.push({ url: row.url
                                      , title: row.title || '<link>'
                                      , annotation: row.annotation
                                      });
           }

           $('#entries').html(Mustache.to_html(template, 
                                               {sections: sections}));

           var end = new Date();
           $('<p/>')
               .text( 'Rendering '+results.rows.length
                    + ' items took '
                    + ((end.getTime() - start.getTime())/1000)
                    + ' seconds.'
                    )
               .appendTo($('body'))
           ;
       }
       );
}

</script>
</head><body>
<h1>all yamemex annotations for web pages</h1>
<div id="entries"></div>
</body></html>
